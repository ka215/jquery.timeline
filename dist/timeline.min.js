/*!
 * jQuery Timeline Plugin
 * ------------------------
 * Version: 1.0.0
 * Author: Ka2 ( https://ka2.org/ )
 * Repository: https://github.com/ka215/jquery.timeline
 * Lisenced: MIT
 */
!function(e){function t(t){var i,r,n,l=e(t),o=l.data("timeline");n=/-|\/|\s|\:/,r=o.timeline.attr("actual-start-datetime").split(n);var c=new Date(Number(r[0]),Number(r[1])-1,Number(r[2]),Number(r[3]),Number(r[4]),Number(r[5]));Number(r[0])<100&&c.setFullYear(Number(r[0]));var h,f,y=e("<div />",{addClass:"timeline-header"}),p=e("<div />",{addClass:"timeline-body"}),g=e("<div />",{addClass:"timeline-footer"}),v=e("<div />",{addClass:"timeline-wrapper"}),b=e("<table />",{addClass:"timeline-timetable timeline-scale"}),w=e("<div />",{addClass:"timeline-events"}),x=e("<table />",{addClass:"timeline-timetable timeline-grids"}),M=e("<div />",{addClass:"timeline-needle-pointer"}),D=e("<div />",{addClass:"timeline-events default-events"}),k=new Date(c),N={years:{medium_scale:"months",medium_cols:12,small_scale:"days",small_cols:Number(o.timeline.attr("min-grid-per"))},months:{medium_scale:"days",medium_cols:new Date(c.getFullYear(),c.getMonth()+1,0).getDate(),small_scale:"hours",small_cols:Number(o.timeline.attr("min-grid-per"))},days:{medium_scale:"hours",medium_cols:24,small_scale:"minutes",small_cols:Number(o.timeline.attr("min-grid-per"))}},F=o.timeline.attr("scale"),Y=N[F].medium_scale,T=N[F].small_scale,C=Number(o.timeline.attr("min-grid-per"))*Number(o.timeline.attr("min-grid-size")),S=[N[F].medium_cols];if(l.hasClass("timeline-container")||l.addClass("timeline-container"),l.find(".timeline-events").length>0&&(l.find(".timeline-events").clone().appendTo(D),a(D,o)),"point"===o.timeline.attr("type")||"mixed"===o.timeline.attr("type"))var H=e("<canvas />",{addClass:"timeline-line-canvas"});if(l.empty(),"years"===o.timeline.attr("scale")?(k.setFullYear(k.getFullYear()+Number(o.timeline.attr("range"))),f=k.getTime(),k.setTime(f-1)):"months"===o.timeline.attr("scale")?(k.setMonth(k.getMonth()+Number(o.timeline.attr("range"))),f=k.getTime(),k.setTime(f-1)):(k.setDate(k.getDate()+Number(o.timeline.attr("range"))),f=k.getTime(),k.setTime(f-1)),"days"===Y&&Number(o.timeline.attr("range"))>1)for(i=1;i<Number(o.timeline.attr("range"));i++)S.push(new Date(c.getFullYear(),c.getMonth()+1+i,0).getDate());else for(i=1;i<Number(o.timeline.attr("range"));i++)S.push(N[F].medium_cols);if(o.timeline.attr("show-headline")){var L,z,I,A,j;switch(o.timeline.attr("scale")){case"years":I=A="",1==o.timeline.attr("zerofill-year")&&(c.getFullYear()<100?I="00":c.getFullYear()<1e3&&(I="0"),k.getFullYear()<100?A="00":k.getFullYear()<1e3&&(A="0")),L=o.timeline.attr("datetime-prefix")+I+u(o.timeline.attr("datetime-format-year"),c),z=o.timeline.attr("datetime-prefix")+A+u(o.timeline.attr("datetime-format-year"),k);break;case"months":L=o.timeline.attr("datetime-prefix")+u(o.timeline.attr("datetime-format-month"),c),z=o.timeline.attr("datetime-prefix")+u(o.timeline.attr("datetime-format-month"),k);break;case"days":L=o.timeline.attr("datetime-prefix")+u(o.timeline.attr("datetime-format-day"),c),z=o.timeline.attr("datetime-prefix")+u(o.timeline.attr("datetime-format-day"),k)}j='<span class="timeline-from-date">'+L+'</span><span class="timeline-to-date">'+z+"</span>",y.append('<h3 class="timeline-headline">'+j+"</h3>")}var O,J,_,E,P="<tr>",W="<tr>",G="<tr>";for(h=d(S)*N[F].small_cols,o.timeline.attr("total-cols",h),i=0;i<Number(o.timeline.attr("range"));i++){switch(P+='<th colspan="'+S[i]*N[F].small_cols+'" class="scale-major scale-'+F+'">',O=new Date(c),F){case"years":O.setFullYear(O.getFullYear()+i),I="",1==o.timeline.attr("zerofill-year")&&(O.getFullYear()<100?I="00":O.getFullYear()<1e3&&(I="0")),_=I+u(o.timeline.attr("datetime-format-years"),O);break;case"months":O.setMonth(O.getMonth()+i),_=u(o.timeline.attr("datetime-format-months"),O);break;case"days":O.setDate(O.getDate()+i),_=u(o.timeline.attr("datetime-format-days"),O)}P+=_+"</th>"}for(P+="</tr>",i=0;i<d(S);i++){switch(O=new Date(c),Y){case"months":J=i%N[F].medium_cols,_=C<18?"":J+1,E=new Date(O.getFullYear(),O.getMonth()+i,1).getTime();break;case"days":O.setDate(O.getDate()+i),_=C<20?"":O.getDate(),E=O.getTime();break;case"hours":J=i%N[F].medium_cols,_=C<40?"":J+":00",E=O.setTime(O.getTime()+36e5*i)}W+='<th colspan="'+N[F].small_cols+'" class="scale-medium scale-'+Y+'" data-cell-datetime="'+E+'">',W+=_+"</th>"}for(W+="</tr>",i=0;i<h;i++)G+='<th class="scale-small scale-'+T+'"><span class="spacer-cell"></span></th>';var X="<tr>";for(i=0;i<h;i++)X+='<td class="scale-small"><span class="spacer-cell"></span></td>';if(X+="</tr>",0==o.timeline.attr("show-pointer"))M.css("display","none");else{var q=m(s(!0),o);!1!==q?M.css("left",q+"px"):M.css("display","none")}var B=e("<div />",{addClass:"timeline-loader",css:{display:"block"}});B.append('<i class="jqtl-spinner"></i><span class="sr-only">Loading...</span>');var U='<div class="timeline-nav">',Q=""===o.timeline.attr("navi-icon-left")?"jqtl-circle-left":o.timeline.attr("navi-icon-left"),$=""===o.timeline.attr("navi-icon-right")?"jqtl-circle-right":o.timeline.attr("navi-icon-right");return U+='<a href="javascript:void(0);" class="timeline-to-prev '+(/^jqtl-circle-.*$/.test(Q)?"timeline-to-prev-default":"timeline-to-prev-custom")+'"><i class="'+Q+'"></i></a>',U+='<a href="javascript:void(0);" class="timeline-to-next '+(/^jqtl-circle-.*$/.test($)?"timeline-to-next-default":"timeline-to-next-custom")+'"><i class="'+$+'"></i></a>',U+="</div>",b.append("<thead>"+P+W+G+"</thead>"),x.append("<tbody>"+X+"</tbody>"),"point"===o.timeline.attr("type")||"mixed"===o.timeline.attr("type")?v.append(b.prop("outerHTML")+w.prop("outerHTML")+H.prop("outerHTML")+x.prop("outerHTML")+M.prop("outerHTML")):v.append(b.prop("outerHTML")+w.prop("outerHTML")+x.prop("outerHTML")+M.prop("outerHTML")),p.append(v),g.append(U),l.append(y),l.append(p),l.append(g),l.append(B.prop("outerHTML")),l}function i(t){var i=e(t),a=i.data("timeline");w="auto"===a.timeline.attr("timeline-height")||"number"!=typeof a.timeline.attr("timeline-height")?Number(a.timeline.attr("rows"))*Number(a.timeline.attr("row-height")):Number(a.timeline.attr("timeline-height"));var r={width:i.find(".timeline-timetable.timeline-scale").outerWidth(),height:63};i.find(".timeline-wrapper")[0].offsetHeight!=r.height+w&&(i.find(".timeline-wrapper").css("height",r.height+w+"px"),i.find(".timeline-events").css("height",w+"px"),i.find(".timeline-line-canvas").css("height",w+"px").attr("width",r.width).attr("height",w),i.find(".timeline-grids").css("height",w+"px")),a.timeline.attr("min-grid-size",Number(a.timeline.attr("min-grid-size"))<5?30:Number(a.timeline.attr("min-grid-size"))),i.find(".spacer-cell").width()!=a.timeline.attr("min-grid-size")-1&&i.find(".spacer-cell").css("width",a.timeline.attr("min-grid-size")-1+"px");var n=-1*((i.find(".timeline-body").outerHeight()-i.find(".timeline-scale").outerHeight())/2+i.find(".timeline-to-prev").outerHeight());return i.find(".timeline-to-prev").css("top",n+"px"),i.find(".timeline-to-next").css("top",n+"px"),i.find(".timeline-body").scroll(function(){var t=e(this).scrollLeft();t<1?i.find(".timeline-to-prev").hide():t>=r.width-e(this).outerWidth()-2?i.find(".timeline-to-next").hide():(i.find(".timeline-to-prev").show(),i.find(".timeline-to-next").show())}),i}function a(t,i){if(e(t).find(".timeline-events").children().length>0){var a=[],r=[],n=1;e(t).find(".timeline-events").children().each(function(){if(e(this).data("timelineNode")){var t=new Function("return "+e(this).data("timelineNode"))();t.label=e(this).text(),t.eventId&&r.push(Number(t.eventId)),a.push(t)}}),a.length>0&&(n=r.length>0?Math.max.apply(null,r)+1:n,a.forEach(function(e,t,i){e.eventId||(i[t].eventId=n,n++)}),i.timeline.text(JSON.stringify(a)))}}function r(t){var i=e(t),a=i.data("timeline"),r=new Function("return "+a.timeline.text())(),l=new Date(a.timeline.attr("actual-start-datetime")),s=new Date(l),m=a.timeline.attr("type"),d=a.timeline.attr("scale"),c=Number(a.timeline.attr("range")),h=Number(a.timeline.attr("row-height")),f=Number(a.timeline.attr("total-cols")),u=Number(a.timeline.attr("min-grid-per")),y=Number(a.timeline.attr("min-grid-size")),p={x:0,y:0,w:0},g=y*f-1;switch(i.find(".timeline-loader").css("display","block"),d){case"years":s.setYear(s.getFullYear()+c);break;case"months":s.setMonth(s.getMonth()+c-1);break;case"days":s.setDate(s.getDate()+c)}i.find(".timeline-events").empty(),r.forEach(function(t){if(t.start){var a,r=new Date(t.start),n=void 0==t.end?new Date(t.start):new Date(t.end),c=u*y;if(o(r,l,s)){switch(d){case"years":p.x=Math.round((r-l)*g/(s-l));break;case"months":p.x=Math.floor((r-l)/864e5*c);break;case"days":p.x=Math.floor((r-l)/36e5*c)}if(p.y=void 0!==t.row?(t.row-1)*h:0,o(n,l,s)){switch(d){case"years":p.w=Math.floor((n-l)/2592e6*c-p.x);break;case"months":p.w=Math.floor((n-l)/864e5*c-p.x);break;case"days":p.w=Math.floor((n-l)/36e5*c-p.x)}0==p.w&&(p.w=1)}else switch(d){case"years":p.w=Math.floor((s-l)/2592e6*c-p.x);break;case"months":p.w=Math.floor((s-l)/864e5*c-p.x);break;case"days":p.w=Math.floor((s-l)/36e5*c-p.x)}}else if(o(n,l,s))switch(p.x=0,p.y=void 0!==t.row?(t.row-1)*h:0,d){case"years":p.w=Math.floor((n-l)/2592e6*c);break;case"months":p.w=Math.floor((n-l)/864e5*c);break;case"days":p.w=Math.floor((n-l)/36e5*c)}else if(o(l,r,n)&&o(s,r,n))switch(p.x=0,p.y=void 0!==t.row?(t.row-1)*h:0,d){case"years":p.w=Math.floor((s-l)/2592e6*c);break;case"months":p.w=Math.floor((s-l)/864e5*c);break;case"days":p.w=Math.floor((s-l)/36e5*c)}else p.w=0;if(p.w>0){if("point"===m){var f=t.margin?Number(t.margin):b;f=(f=f<0?0:f)>h/2?h/2-1:f,a=e("<div />",{addClass:"timeline-node timeline-event-pointer",id:"evt-"+t.eventId,css:{left:p.x-Math.floor(h/2)+f+"px",top:p.y+f+"px",width:h-2*f+"px",height:h-2*f+"px"},title:t.label}),t.bdColor?a.css("border-color",t.bdColor):t.bgColor&&a.css("border-color",t.bgColor),t.image&&a.css("background-image","url("+t.image+")"),t.relation&&e.each(t.relation,function(t,i){-1==e.inArray(t,["before","after","size"])||isNaN(i)?"curve"===t?-1!=e.inArray(i,["lt","rt","lb","rb"])&&a.attr("data-relay-curve",i):a.attr("data-relay-"+t,i):a.attr("data-relay-"+t,Number(i))})}else a=e("<div />",{addClass:"timeline-node timeline-text-truncate",id:"evt-"+t.eventId,css:{left:p.x+"px",top:p.y+"px",width:p.w+"px"},text:t.label}),t.color&&a.css("color",t.color),p.w<y&&a.css("padding-left","1.5rem").css("padding-right","0").css("text-overflow","clip");t.bgColor&&a.css("background-color",t.bgColor),t.extend&&e.each(t.extend,function(e,t){a.attr("data-"+e,t)}),i.find(".timeline-events").append(a.prop("outerHTML"))}}}),i.find(".timeline-loader").css("display","none"),"point"!==m&&"mixed"!==m||(n(i),i.find(".timeline-event-pointer").hover(function(t){var i;"mouseenter"===t.type?(i={left:parseInt(e(this).css("left")),top:parseInt(e(this).css("top")),width:parseInt(e(this).css("width")),height:parseInt(e(this).css("height"))},e(this).attr("data-default-axis",JSON.stringify(i)),e(this).hasClass("hovered")||e(this).addClass("hovered").animate({left:i.left-h/10,top:i.top-h/10,width:i.width+h/10*2,height:i.height+h/10*2},0)):"mouseleave"===t.type&&(i=e(this).data("defaultAxis"),e(this).css("left",i.left+"px").css("top",i.top+"px").css("width",i.width+"px").css("height",i.height+"px"),e(this).removeAttr("data-default-axis"),e(this).hasClass("hovered")&&e(this).removeClass("hovered"))}))}function n(t){function i(e,t,i){if("object"==typeof e&&"object"==typeof t){i=i||!1;var r,n={x:Math.abs((e.x-t.x)/y),y:Math.abs((e.y-t.y)/y)};if(a.beginPath(),a.moveTo(e.x,e.y),!1!==i){switch(i){case"lt":r={relayStartX:e.x,relayStartY:t.y+y,cpx:e.x,cpy:t.y,relayEndX:e.x+y,relayEndY:t.y};break;case"rt":r={relayStartX:t.x-y,relayStartY:e.y,cpx:t.x,cpy:e.y,relayEndX:t.x,relayEndY:e.y+y};break;case"lb":r={relayStartX:e.x,relayStartY:t.y-y,cpx:e.x,cpy:t.y,relayEndX:e.x+y,relayEndY:t.y};break;case"rb":r={relayStartX:t.x-y,relayStartY:e.y,cpx:t.x,cpy:e.y,relayEndX:t.x,relayEndY:e.y-y}}(n.x>1||n.y>1)&&a.lineTo(r.relayStartX,r.relayStartY),a.quadraticCurveTo(r.cpx,r.cpy,r.relayEndX,r.relayEndY)}a.lineTo(t.x,t.y),a.stroke()}}var a,r=t.find(".timeline-node.timeline-event-pointer"),n=t.find(".timeline-line-canvas")[0];n.getContext&&(a=n.getContext("2d"),r.each(function(){var t,r,l,s,o,m,d=void 0==e(this).data("relayLinecolor")?e(this).css("border-left-color"):e(this).data("relayLinecolor"),c=void 0==e(this).data("relayLinesize")?Math.round(y/10):e(this).data("relayLinesize");a.strokeStyle=d,a.lineWidth=c,a.lineJoin="round",a.lineCap="round",s={x:(y-a.lineWidth)/2,y:y/2},o=Math.floor((y-e(this)[0].offsetWidth)/2),t={x:e(this)[0].offsetLeft-o+s.x,y:Math.floor(e(this)[0].offsetTop/y)*y+s.y},void 0!=e(this).data("relayBefore")&&(e(this).data("relayBefore")>0&&e("#evt-"+e(this).data("relayBefore"))>0?(o=Math.floor((y-e("#evt-"+e(this).data("relayBefore"))[0].offsetWidth)/2),r={x:e("#evt-"+e(this).data("relayBefore"))[0].offsetLeft-o+s.x,y:Math.floor(e("#evt-"+e(this).data("relayBefore"))[0].offsetTop/y)*y+s.y}):r={x:0,y:t.y},m=(r.y-t.y)/y,Math.abs(m)>0&&void 0!=e(this).data("relayCurve")&&-1!=e.inArray(e(this).data("relayCurve"),["lt","rt","lb","rb"])?i(r,t,e(this).data("relayCurve")):i(r,t)),void 0!=e(this).data("relayAfter")&&(e(this).data("relayAfter")>0&&e("#evt-"+e(this).data("relayAfter"))>0?(o=Math.floor((y-e("#evt-"+e(this).data("relayAfter"))[0].offsetWidth)/2),l={x:e("#evt-"+e(this).data("relayAfter"))[0].offsetLeft-o+s.x,y:Math.floor(e("#evt-"+e(this).data("relayAfter"))[0].offsetTop/y)*y+s.y}):l={x:n.width,y:t.y},m=(t.y-l.y)/y,Math.abs(m)>0&&void 0!=e(this).data("relayCurve")&&-1!=e.inArray(e(this).data("relayCurve"),["lt","rt","lb","rb"])?i(t,l,e(this).data("relayCurve")):i(t,l))}))}function l(t){if(0==e(".timeline-event-view").length)return!0;e(".timeline-event-view").empty();var i,a=e("<div />",{addClass:"timeline-event-header"}),r=e("<h3 />",{addClass:"timeline-event-label"}),n=e("<div />",{addClass:"timeline-event-meta"}),l=e("<div />",{addClass:"timeline-event-body"}),s=e("<div />",{addClass:"timeline-event-footer"});return r.text(t.label),i='<span class="timeline-event-start-date">'+u("Y/m/d H:i",t.start)+"</span>",t.end&&(i+='<span class="timeline-event-date-separator"></span>',i+='<span class="timeline-event-end-date">'+u("Y/m/d H:i",t.end)+"</span>"),a.append(r.prop("outerHTML")+n.append(i).prop("outerHTML")),t.content&&l.html(t.content),e(".timeline-event-view").append(a.prop("outerHTML")+l.prop("outerHTML")+s.prop("outerHTML")),!0}function s(t){var i=new Date;return t&&M().then(function(){i=e("body").data("serverDate"),e.removeData("body","serverDate")},function(){i=new Date}),i}function o(e,t,i){var a=new Date(e).getTime(),r=new Date(t).getTime(),n=new Date(i).getTime();return a-r>=0&&n-a>=0}function m(e,t){e="[object Date]"===Object.prototype.toString.call(e)?e:new Date(e);var i,a,r=t.timeline,n=new Date(r.attr("actual-start-datetime")),l=new Date(n),s=r.attr("scale"),m=Number(r.attr("range")),d=Number(r.attr("total-cols")),c=Number(r.attr("min-grid-per")),h=Number(r.attr("min-grid-size")),f=h*d-1,u=c*h;switch(s){case"years":i=(l=new Date(l.setFullYear(l.getFullYear()+m))).getTime(),l.setTime(i-1);break;case"months":i=(l=new Date(l.setMonth(l.getMonth()+m))).getTime(),l.setTime(i-1);break;case"days":i=(l=new Date(l.setDate(l.getDate()+m))).getTime(),l.setTime(i-1)}if(o(e,n,l)){switch(s){case"years":a=Math.round((e-n)*f/(l-n));break;case"months":a=Math.floor((e-n)/864e5*u);break;case"days":a=Math.floor((e-n)/36e5*u)}return a}return!1}function d(e){return e.reduce(function(e,t){return e+t})}function c(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t}function h(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}function f(e,t){var i=function(e,t){return Array(e+1).join(t)}(t-1,"0");return String(e).length==t?e:(i+e).substr(-1*e)}function u(e,t){var i="[object Date]"===Object.prototype.toString.call(t)?t:new Date(t),a=p,r=g,n=v,l=e.split(""),s="",o=!1,m=function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,1);return t.setTime(t.getTime()-1),t.getDate()},d=function(e){var t,i=new Date(e.getFullYear(),0,1),a=0;for(t=0;t<12;t++)i.setMonth(t),a+=m(i);return 365===a?0:1},u=function(e){var t,i=new Date(e.getFullYear(),0,1),a=0;for(t=0;t<e.getMonth();t++)i.setMonth(t),a+=m(i);return a+e.getDate()},y=function(e){var t=e.getHours();return t>12?t-12:t},b=function(e){return e.getHours()>12?n[1]:n[0]};return""===e?i:(l.forEach(function(e,t){var n,p,g,v;if(!1!==o)return o=!1,!0;switch(e){case"Y":case"o":n=i.getFullYear();break;case"y":n=(""+i.getFullYear()).slice(-2);break;case"m":n=("0"+(i.getMonth()+1)).slice(-2);break;case"n":n=i.getMonth()+1;break;case"F":n=c(a)[i.getMonth()];break;case"M":n=h(a)[i.getMonth()];break;case"d":n=("0"+i.getDate()).slice(-2);break;case"j":n=i.getDate();break;case"S":n=["st","nd","rd","th"][function(){var e=i.getDate();return 1==e||2==e||3==e||21==e||22==e||23==e||31==e?Number((""+e).slice(-1)-1):3}()];break;case"w":case"W":n=i.getDay();break;case"l":n=c(r)[i.getDay()];break;case"D":n=h(r)[i.getDay()];break;case"N":n=0===i.getDay()?7:i.getDay();break;case"a":n=b(i);break;case"A":n=b(i).toUpperCase();break;case"g":n=y(i);break;case"h":n=("0"+y(i)).slice(-2);break;case"G":n=i.getHours();break;case"H":n=("0"+i.getHours()).slice(-2);break;case"i":n=("0"+i.getMinutes()).slice(-2);break;case"s":n=("0"+i.getSeconds()).slice(-2);break;case"z":n=u(i);break;case"t":n=m(i);break;case"L":n=d(i);break;case"c":p=i.getTimezoneOffset(),g=[Math.floor(Math.abs(p)/60),Math.abs(p)%60],v=p<0?"+":"-",n=i.getFullYear()+"-"+f(i.getMonth()+1,2)+"-"+f(i.getDate(),2)+"T",n+=f(i.getHours(),2)+":"+f(i.getMinutes(),2)+":"+f(i.getSeconds(),2),n+=v+f(g[0],2)+":"+f(g[1],2);break;case"r":p=i.getTimezoneOffset(),g=[Math.floor(Math.abs(p)/60),Math.abs(p)%60],v=p<0?"+":"-",n=h(r)[i.getDay()]+", "+i.getDate()+" "+h(a)[i.getMonth()]+" "+i.getFullYear()+" ",n+=f(i.getHours(),2)+":"+f(i.getMinutes(),2)+":"+f(i.getSeconds(),2)+" ",n+=v+f(g[0],2)+f(g[1],2);break;case"u":n=i.getTime();break;case"U":n=Date.parse(i)/1e3;break;case"\\":o=!0,n=l[t+1];break;default:n=e}s+=n}),s)}var y,p,g,v,b=2,w=0,x={init:function(a){var n=e.extend({type:"bar",scale:"days",startDatetime:"currently",datetimePrefix:"",showHeadline:!0,datetimeFormat:{full:"j M Y",year:"Y",month:"M Y",day:"D, j M",years:"Y",months:"F",days:"j"},minuteInterval:30,zerofillYear:!1,range:3,rows:5,rowHeight:40,height:"auto",minGridPer:2,minGridSize:30,rangeAlign:"current",naviIcon:{left:"jqtl-circle-left",right:"jqtl-circle-right"},showPointer:!0,i18n:{month:{Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},day:{Sun:"Sunday",Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thurseday",Fri:"Friday",Sat:"Saturday"},ma:["am","pm"]}},a);return this.each(function(){var a=e(this),l=a.data("timeline"),o=e("<div />",{title:a.find(".timeline-headline").text(),type:n.type,scale:n.scale,"start-datetime":n.startDatetime,"datetime-prefix":n.datetimePrefix,"show-headline":n.showHeadline?1:0,"datetime-format-full":n.datetimeFormat.full,"datetime-format-year":n.datetimeFormat.year,"datetime-format-month":n.datetimeFormat.month,"datetime-format-day":n.datetimeFormat.day,"datetime-format-years":n.datetimeFormat.years,"datetime-format-months":n.datetimeFormat.months,"datetime-format-days":n.datetimeFormat.days,"minute-interval":n.minuteInterval,"zerofill-year":n.zerofillYear?1:0,range:n.range,rows:n.rows,"row-height":n.rowHeight,"timeline-height":n.height,"min-grid-per":n.minGridPer,"min-grid-size":n.minGridSize,"range-align":n.rangeAlign,"navi-icon-left":n.naviIcon.left,"navi-icon-right":n.naviIcon.right,"show-pointer":n.showPointer?1:0,"i18n-month":JSON.stringify(n.i18n.month),"i18n-day":JSON.stringify(n.i18n.day),"i18n-ma":JSON.stringify(n.i18n.ma),text:""});if(a.on("click.timeline",".timeline-to-prev",x.dateback),a.on("click.timeline",".timeline-to-next",x.dateforth),a.on("click.timeline",".timeline-node",x.openEvent),a.on("align.timeline",x.alignment),!l){a.data("timeline",{target:a,timeline:o}),y=n.rowHeight,p=n.i18n.month,g=n.i18n.day,v=n.i18n.ma;var m,d,c,h;switch("currently"===n.startDatetime?m=s(!0):(m=new Date(n.startDatetime),h=/-|\//,c=n.startDatetime.split(h),Number(c[0])<100&&m.setFullYear(Number(c[0]))),n.scale){case"years":d=m.getFullYear()+"-01-01 00:00:00";break;case"months":d=m.getFullYear()+"-"+(m.getMonth()+1)+"-01 00:00:00";break;case"days":d=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate()+" 00:00:00";break;default:d=m.getFullYear()+"-"+(m.getMonth()+1)+"-"+m.getDate()+" "+d.getHours()+":00:00"}a.data("timeline").timeline.attr("actual-start-datetime",d),t(a),i(a),a.trigger("align.timeline",[n.rangeAlign]),a.css("visibility","visible")}r(a)})},destroy:function(){return this.each(function(){var t=e(this),i=t.data("timeline");e(window).off(".timeline"),i&&(i.timeline.remove(),t.removeData("timeline"))})},render:function(a){return this.each(function(){var n=e(this),l=n.data("timeline");"type"in a&&l.timeline.attr("type",a.type),"scale"in a&&l.timeline.attr("scale",a.scale),"startDatetime"in a&&l.timeline.attr("start-datetime",a.startDatetime),"datetimePrefix"in a&&l.timeline.attr("datetime-prefix",a.datetimePrefix),"showHeadline"in a&&l.timeline.attr("show-headline",a.showHeadline?1:0),"datetimeFormat"in a&&(void 0!=typeof a.datetimeFormat.full&&l.timeline.attr("datetime-format-full",a.datetimeFormat.full),void 0!=typeof a.datetimeFormat.year&&l.timeline.attr("datetime-format-year",a.datetimeFormat.year),void 0!=typeof a.datetimeFormat.month&&l.timeline.attr("datetime-format-month",a.datetimeFormat.month),void 0!=typeof a.datetimeFormat.day&&l.timeline.attr("datetime-format-day",a.datetimeFormat.day),void 0!=typeof a.datetimeFormat.years&&l.timeline.attr("datetime-format-years",a.datetimeFormat.years),void 0!=typeof a.datetimeFormat.months&&l.timeline.attr("datetime-format-months",a.datetimeFormat.months),void 0!=typeof a.datetimeFormat.days&&l.timeline.attr("datetime-format-days",a.datetimeFormat.days)),"minuteInterval"in a&&l.timeline.attr("minute-interval",a.minuteInterval),"zerofillYear"in a&&l.timeline.attr("zerofill-year",a.zerofillYear?1:0),"range"in a&&l.timeline.attr("range",a.range),"rows"in a&&l.timeline.attr("rows",a.rows),"rowHeight"in a&&l.timeline.attr("row-height",a.rowHeight),"height"in a&&l.timeline.attr("timeline-height",a.height),"minGridPer"in a&&l.timeline.attr("min-grid-per",a.minGridPer),"minGridSize"in a&&l.timeline.attr("min-grid-size",a.minGridSize),"rangeAlign"in a&&l.timeline.attr("range-align",a.rangeAlign),"naviIcon"in a&&(void 0!=typeof a.naviIcon.left&&l.timeline.attr("navi-icon-left",a.naviIcon.left),void 0!=typeof a.naviIcon.right&&l.timeline.attr("navi-icon-right",a.naviIcon.right)),"showPointer"in a&&l.timeline.attr("show-pointer",a.showPointer?1:0),"i18n"in a&&(void 0!=typeof a.i18n.month&&l.timeline.attr("i18n-month",JSON.stringify(a.i18n.month)),void 0!=typeof a.i18n.day&&l.timeline.attr("i18n-day",JSON.stringify(a.i18n.day)),void 0!=typeof a.i18n.ma&&l.timeline.attr("i18n-ma",JSON.stringify(a.i18n.ma)));var o,m,d,c;switch("currently"===l.timeline.attr("start-datetime")?o=s(!0):(o=new Date(l.timeline.attr("start-datetime")),c=/-|\//,d=l.timeline.attr("start-datetime").split(c),Number(d[0])<100&&o.setFullYear(Number(d[0]))),l.timeline.attr("scale")){case"years":m=o.getFullYear()+"-01-01 00:00:00";break;case"months":m=o.getFullYear()+"-"+(o.getMonth()+1)+"-01 00:00:00";break;case"days":m=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()+" 00:00:00";break;default:m=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()+" "+m.getHours()+":00:00"}l.timeline.attr("actual-start-datetime",m),n.find(".timeline-container").empty().removeClass("timeline-container"),t(n),i(n),r(n),n.trigger("align.timeline",[l.timeline.attr("range-align")])})},show:function(){return this.each(function(){e(this).css("display","block").css("visibility","visible")})},hide:function(){return this.each(function(){e(this).css("visibility","hidden").css("display","none")})},initialized:function(t){return this.each(function(){var i=e(this),a=i.data("timeline");a&&"function"==typeof t&&t(i,a)})},dateback:function(t){t.preventDefault();var i=e(this).parents(".timeline-container"),a=i.data("timeline"),r=i.find(".timeline-body")[0].clientWidth,n=i.find(".timeline-wrapper")[0].scrollWidth,l=i.find(".timeline-body").scrollLeft(),s=0;return n>r&&(s=(s=l/r>1?l-r:l-(n-r)/Number(a.timeline.attr("range")))<0?0:s,i.find(".timeline-body").animate({scrollLeft:s},300)),this},dateforth:function(t){t.preventDefault();var i=e(this).parents(".timeline-container"),a=i.data("timeline"),r=i.find(".timeline-body")[0].clientWidth,n=i.find(".timeline-wrapper")[0].scrollWidth,l=i.find(".timeline-body").scrollLeft(),s=0;return n>r&&(s=(s=(n-l)/r>1?l+r:l+(n-r)/Number(a.timeline.attr("range")))>n-r+1?n-r+1:s,i.find(".timeline-body").animate({scrollLeft:s},300)),this},alignment:function(){var t=arguments.length>1?Array.prototype.slice.call(arguments,1):[arguments[0]],i=t[0].toLowerCase(),a=void 0!==t[1]?String(t[1]).toLowerCase():0,r=e(this).find(".timeline-body")[0].clientWidth,n=e(this).find(".timeline-wrapper")[0].scrollWidth,l=0;if(n>r){var o,d=e(this).data("timeline");switch(i){case"left":l=0;break;case"right":l=n-r+1;break;case"center":l=(n-r)/2;break;case"current":l=(o=m(s(!0),d))>-1?o-r/2>n-r+1?n-r+1:o-r/2:n-r+1;break;case"latest":var c,h,f,y=new Function("return "+d.timeline.text())();e.each(y,function(e,t){h=u("U",t.start),0==e?(c=h,f=e):h>=c&&(c=h,f=e)}),l=(o=m(new Date(y[f].start),d))>-1?o-r/2>n-r+1?n-r+1:o-r/2:n-r+1;break;default:l=0;var p="#"+i;e(p).length&&(l=(o=e(p).position().left)-r/2>n-r+1?n-r+1:o-r/2)}-1!=e.inArray(a,["slow","normal","fast"])||Number(a)>0?e(this).find(".timeline-body").animate({scrollLeft:l},a):e(this).find(".timeline-body").scrollLeft(l)}return this},getOptions:function(){var t=e(this).data("timeline");return{title:t.timeline.attr("title"),type:t.timeline.attr("type"),scale:t.timeline.attr("scale"),startDatetime:t.timeline.attr("start-datetime"),datetimePrefix:t.timeline.attr("datetime-prefix"),showHeadline:1==Number(t.timeline.attr("show-headline")),datetimeFormat:{full:t.timeline.attr("datetime-format-full"),year:t.timeline.attr("datetime-format-year"),month:t.timeline.attr("datetime-format-month"),day:t.timeline.attr("datetime-format-day"),years:t.timeline.attr("datetime-format-years"),months:t.timeline.attr("datetime-format-months"),days:t.timeline.attr("datetime-format-days")},minuteInterval:Number(t.timeline.attr("minute-interval")),zerofillYear:1==Number(t.timeline.attr("zerofill-year")),range:Number(t.timeline.attr("range")),rows:Number(t.timeline.attr("rows")),rowHeight:Number(t.timeline.attr("row-height")),height:"auto"===t.timeline.attr("timeline-height")?"auto":Number(t.timeline.attr("timeline-height")),minGridPer:Number(t.timeline.attr("min-grid-per")),minGridSize:Number(t.timeline.attr("min-grid-size")),rangeAlign:t.timeline.attr("range-align"),naviIcon:{left:t.timeline.attr("navi-icon-left"),right:t.timeline.attr("navi-icon-right")},showPointer:t.timeline.attr("show-pointer"),i18n:{month:JSON.parse(t.timeline.attr("i18n-month")),day:JSON.parse(t.timeline.attr("i18n-day")),ma:JSON.parse(t.timeline.attr("i18n-ma"))},events:new Function("return "+t.timeline.text())()}},addEvent:function(t,i){return this.each(function(){var a=e(this),n=a.data("timeline"),l=new Function("return "+n.timeline.text())(),s=1,o=[s];t.length>0&&(e.each(l,function(e,t){o.push(Number(t.eventId))}),s=Math.max.apply(null,o)+1,e.each(t,function(e,t){t.eventId=s,s++,l.push(t)}),n.timeline.text(JSON.stringify(l))),r(a),e(this).trigger("align.timeline",["evt-"+(s-1),"fast"]),n&&"function"==typeof i&&i(a,n)})},removeEvent:function(){var t,i;return 0==arguments.length?(t="all",i=null):1==arguments.length?"function"==typeof arguments[0]?(t="all",i=arguments[0]):(t=arguments[0],i=null):(t=arguments[0],i=arguments[1]),this.each(function(){var a=e(this),n=a.data("timeline"),l=new Function("return "+n.timeline.text())();if("all"===t)l=[];else{var s=[];e.each(l,function(i,a){-1==e.inArray(a.eventId,t)&&s.push(a)}),l=s}n.timeline.text(JSON.stringify(l)),r(a),n&&"function"==typeof i&&i(a,n)})},updateEvent:function(t,i){return void 0!==t&&this.each(function(){var a,n=e(this),l=n.data("timeline"),s=new Function("return "+l.timeline.text())(),o=[];t.length>0&&e.each(t,function(e,t){o.push(t.eventId)}),s.length>0&&o.length>0&&(e.each(s,function(i,r){if(-1!=e.inArray(r.eventId,o)){var n;e.each(t,function(e,t){if(t.eventId==r.eventId)return n=t,a=t.eventId,!1}),s[i]=n}}),l.timeline.text(JSON.stringify(s))),r(n),e(this).trigger("align.timeline",["evt-"+a,"fast"]),l&&"function"==typeof i&&i(n,l)})},openEvent:function(t){var i=Number(e(t.target).attr("id").replace("evt-","")),a=t.delegateTarget;return""!==i&&0!=i&&e(a).each(function(){var t,a=e(this).data("timeline"),r=new Function("return "+a.timeline.text())();e.each(r,function(e,a){if(a.eventId==i)return t=a,!1}),e(this).find(".timeline-node").each(function(){e(this).attr("id")==="evt-"+i?e(this).addClass("active"):e(this).removeClass("active")}),e(this).trigger("align.timeline",["evt-"+i,"fast"]),l(t)&&t.callback&&Function.call(null,"return "+t.callback)()})}};e.fn.timeline=function(t){return x[t]?x[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.timeline."):x.init.apply(this,arguments)};var M=function(){return e.ajax({type:"GET"}).done(function(t,i,a){e("body").data("serverDate",new Date(a.getResponseHeader("Date")))}).promise()}}(jQuery);